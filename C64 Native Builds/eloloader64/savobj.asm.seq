;*********************************; ENTRY POINT;*********************************SAVOBJ =*;*********************************; START UP MESSAGE;*********************************; LDA #<MSF1; LDY #>MSF1; JSR STRPNT LDX #MSG9-MSG1  ;OFFSET FOR MSG JSR PRINT       ;PRG NAME: ;*********************************; READ IN DISK FILE ?;********************************* JSR INSTNF LDA BUF CMP #$0D BNE PFILE0 LDX #MSG10-MSG1 ;OFFSET FOR MSG JSR PRINT       ;PRINT OBJ NOT SAVED RTS;*********************************; APPEND ,P,W;*********************************PFILE0 LDX #$00PFILE1 LDA PROGM,X STA BUF,Y INY INX CPX #$04 BNE PFILE1 STY SAVA ; LENGTH OF FILE NAME;*********************************; ADD ONE TO END ADDRESS;********************************* JSR ADDONE ;*********************************; SAVE FILE;********************************* JSR SVFILE;*********************************; DONE;********************************* RTS;*********************************;;*********************************PROGM .BYTE ',P,W';*********************************SAVA .BYTE $AA;*********************************; ADD '1' TO EA FOR KERNAL SAVE;*********************************ADDONE =* CLC ; CLEAR CARRY LDA EA ADC #$01 STA EA ; STORE SUM OF LSBS LDA EA+1 ADC #$00 ; ADD THE MSBS USING CARRY FROM STA EA+1 ; THE PREVIOUS CALCULATION RTS;*********************************; INPUT UTILITIES;*********************************; INPUT STRING ROUTINE;*********************************INSTNF LDY #$00INSTN2 JSR CHRIN STA BUF,Y INY CMP #$0D BNE INSTN2 DEY RTS;*********************************; OPEN PROGRAM FILE;*********************************SVFILE LDA SAVA ; LENGHT OF FILE NAME LDX #<BUF LDY #>BUF JSR SETNAM; LDA #$08; TAY; TAX; JSR SETLFS LDA #$00 LDX #$08 LDY #$01 JSR SETLFS;*********************************; SAVE THE FILE; EXAMBLE CODE USED $2B-$2C; TXTTAB WHICH IN POINTER TO; START OF BASIC. A SAVE FROM ANYWHERE; OTHER THAN $0801 WRECKS BASIC;********************************* LDA SA STA ZEROUR   ;WAS $2B LDA SA+1 STA ZEROUR+1 ;WAS $2C;  LDA #ZEROUR ; zero-page index to the pointer LDX EA LDY EA+1 JSR SAVE;*********************************;;********************************* BCC OKSAV ; CARRY CLEAR = OK LDX #MSG10-MSG1 ;OFFSET FOR MSG JSR PRINT       ;PRINT OBJ NOT SAVED ;*********************************;;*********************************OKSAV =* LDA #$08 JSR CLOSE RTS;*********************************.END